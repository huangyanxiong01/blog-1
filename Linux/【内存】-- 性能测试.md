- 性能指标
- 待测指标
- 测试工具
- 测试演示

---

### 概述

本文先了解下内存架构的演进，然后指出内存主要的性能指标，最后通过工具去演示如何测试内存的性能。

---

### 内存架构

#### UMA (均匀内存访问)

早期的多核 CPU 和内存一般都采用 UMA 架构，每个核通过 FSB (前端系统总线) 与 MCH (主板上的内存控制器) 相连，MCH 再与内存相连。UMA 架构下每个核对内存的访问延迟并没有差距。如下图：

![](https://raw.githubusercontent.com/hsxhr-10/picture/master/内存uma.png)

#### NUMA (非均匀内存访问)

但是随着核数的越来越多的发展趋势下，FSB 和 MCH 成为了 CPU 访问内存的性能瓶颈。这也催生了 NUMA 架构的诞生，NUMA 和 UMA 最大的不同是去掉了 FSB，且 MCH 被集成到了每个核内部。如下图：

![](https://raw.githubusercontent.com/hsxhr-10/picture/master/内存numa.png)

#### 服务器内存架构实物

![](https://raw.githubusercontent.com/hsxhr-10/picture/master/服务器内存实物.png)

---

### 性能指标

- 吞吐量 (throughput)：即内存每秒能传输的字节数
- 访问延迟 (latency)：访问一次内存所需的时间
  - 当内存访问命中 cache 时，访存延迟通常是 ns 级别的
  - 若内存访问引起操作系统的 page fault，访存延迟对应用来说就推迟到了 us ，甚至百 us 级别
  - 若内存访问时的 page fault 遭遇了物理内存紧张，引发了操作系统的页回收，访存延迟可以推迟到 ms 级，一些极端情况可以是百 ms 级，直至 s 级

---

### 测试工具

