#### 问题

两台服务器A和B的网络配置如下图，B的子网掩码本应该是255.255.255.0，被不小心配成了255.255.255.224。它们还能正常通信吗？(假设网关的两端都是连着两个服务器，且网关是三层设备)

![](https://raw.githubusercontent.com/hsxhr-10/picture/master/网络io热身1.png)

#### 解答

网络通信的三要素：**主机 ip、子网掩码、网关 ip**。

- 通过 ip 地址和子网掩码可以计算是否在同一个子网
- 通过网关可以判断如果不同子网能否通信


1. 假设从 A 向 B 发出 ping。根据 A 的子网掩码和 A 的 ip 地址可以计算 A 所处的子网是 192.168.26.0；同时根据 A 的子网掩码 和 B 的 ip 地址可以算得 B 所处的子网也是 192.168.26.0 (注意，因为是从 A 出发，因此在判断子网时都是以 A 的子网掩码为标准)
2. 由此可得 A 和 B 是处于同一个子网内，无需经过网关，直接通过 ARP 协议广播即可
3. B 在收到 A 的数据包后给予回应。跟 1 类似，算得 B 所处的子网是 192.168.26.0；算得 A 所处的子网是 192.168.26.128
4. 从 B 向 A 回应 ping，B 和 A 不是处于同一个子网，B 需要先跟网关走一遍 ARP 协议，把数据包发送到网关，网关再跟 A 子网走 ARP 协议，将数据包发送给 A

> 问题后面的假设也是很重要的，如果没有这两个前置条件，还需要考虑这个网关是否正常连通着两个服务器所在的子网，网关是否三层设备

附上一些小工具：[在线计算器](http://help.bitscn.com/ip/)
