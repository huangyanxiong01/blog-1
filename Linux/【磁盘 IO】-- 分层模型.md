时至今日，CPU 主频早已突破 3GHz，内存也步入 DDR4 时代，磁盘在容量上越来越大，但是机械磁盘读写性能性能的增长却远远跟不上 CPU 和内存，这是由于机械磁盘的物理结构的限制 (可以参考 [直观图](https://github.com/hsxhr-10/blog/blob/master/Linux/%E3%80%90%E7%A3%81%E7%9B%98%20IO%E3%80%91--%20%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87(%E8%A3%B8%E7%9B%98).md))，这也让机械磁盘 I/O 成了计算机性能提高的一个瓶颈。虽然有 SSD 磁盘的出现，读写 I/O 的性能比机械磁盘翻了 2 个数量级，但其较高的价格使得无法短时间内替代机械磁盘。

同时，对于系统管理员来说，相比 CPU 和内存的优化，磁盘 I/O 的性能优化选择多很多，但是，这些优化都是建立在一定的知识储备上的，如果没有这些储备就直接跳到优化这一步，就无法做到结合自己的实际情况，只能生搬硬套或者 “凭感觉” 去修改参数，这样往往会没效果甚至有反效果。因此，我觉得很有必要从块设备子系统的分层模型出发，逐层击破，弄明白各层的作用和联系，这样在优化时才有方向感。

---

一个磁盘系统的分层模型如下：

![](https://raw.githubusercontent.com/hsxhr-10/picture/master/%E7%A3%81%E7%9B%98%E5%88%86%E5%B1%82%E6%A8%A1%E5%9E%8B.png)

下面简单介绍每一层的意义：

- **VFS Layer**：虚拟文件系统层。为一个抽象层，为上层用户空间屏蔽下层实际文件系统的细节，提供一套统一的文件系统操作接口，正是由于该层的存在才使得用户空间只需调用同一个 read() 函数，就可以即对 Ext3 文件系统读取，也可以对 NFS 文件系统读取 (可优化层度中等)。
- **FS Layer**：真实文件系统层。具体的文件系统，跟 VFS 存在映射关系 (可优化层度中等)。
- **Page Cache Layer**：页缓存层。提供预读和回写机制，极大提高了磁盘的 I/O 性能 (可优化层度大，很多相关的优化也是基于这一层)。
- **Generic Block Layer**：通用块层。负责打通上三层和下三层，将上三层对块数据的 I/O 请求转换成下三层能看懂的请求，发出真正的对扇区数据的 I/O 请求 (可优化层度低)。
- **I/O Scheduler Layer**：I/O 调度层。提供不同的调度算法，将 I/O 请求入队，且在适当的时候向下层发出 I/O 请求，同时也会将相邻的 I/O 请求合并，提高效率 (可优化层度中等)。
- **Block Device Drive Layer**：块设备驱动层。磁盘设备的驱动程序，负责和磁盘控制器打交道 (可优化层度低)。
- **Block Device Layer**：块设备层。磁盘控制器，磁盘设备等硬件层 (可优化层度低)。

> 可优化程度并非从修改内核代码层面出发
