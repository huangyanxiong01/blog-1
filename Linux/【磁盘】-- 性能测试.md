### 待测指标

- 随机读 IOPS
- 随机写 IOPS
- 顺序读 IOPS
- 顺序写 IOPS
- 延迟

---

### 工具

- fio：用于测试 IOPS 相关
- ioping：用于测试延迟

> 注意：fio 测试会破坏文件系统，谨慎使用

---

### 测试示例

#### 测试随机写 IOPS

```
root@Lab:/home/tiger# fio -direct=1 -iodepth=128 -rw=randwrite -ioengine=libaio -bs=4k -size=1G -numjobs=1 -runtime=1000 -group_reporting -filename=/dev/dm-0 -name=Rand_Write_Testing

# 结果
Rand_Write_Testing: (g=0): rw=randwrite, bs=4K-4K/4K-4K/4K-4K, ioengine=libaio, iodepth=128
fio-2.1.3
Starting 1 process
Jobs: 1 (f=1): [w] [100.0% done] [0KB/53072KB/0KB /s] [0/13.3K/0 iops] [eta 00m:00s]
Rand_Write_Testing: (groupid=0, jobs=1): err= 0: pid=2749: Mon Jun  4 15:49:52 2018
  write: io=1024.0MB, bw=48273KB/s, iops=12068, runt= 21722msec
    slat (usec): min=1, max=10844, avg=19.38, stdev=55.05
    clat (usec): min=441, max=902146, avg=10580.11, stdev=22526.92
     lat (usec): min=520, max=902150, avg=10599.93, stdev=22526.97
    clat percentiles (usec):
     |  1.00th=[ 1752],  5.00th=[ 2832], 10.00th=[ 3696], 20.00th=[ 5152],
     | 30.00th=[ 6560], 40.00th=[ 7904], 50.00th=[ 9280], 60.00th=[10560],
     | 70.00th=[11968], 80.00th=[13504], 90.00th=[15552], 95.00th=[17280],
     | 99.00th=[31616], 99.50th=[45824], 99.90th=[230400], 99.95th=[407552],
     | 99.99th=[880640]
    bw (KB  /s): min=15074, max=56816, per=100.00%, avg=49291.00, stdev=9568.90
    lat (usec) : 500=0.01%, 750=0.01%, 1000=0.04%
    lat (msec) : 2=1.67%, 4=10.25%, 10=43.58%, 20=41.91%, 50=2.12%
    lat (msec) : 100=0.14%, 250=0.19%, 500=0.05%, 1000=0.05%
  cpu          : usr=11.56%, sys=40.50%, ctx=94661, majf=0, minf=8
  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=0.1%, >=64=100.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.1%
     issued    : total=r=0/w=262144/d=0, short=r=0/w=0/d=0

Run status group 0 (all jobs):
  WRITE: io=1024.0MB, aggrb=48272KB/s, minb=48272KB/s, maxb=48272KB/s, mint=21722msec, maxt=21722msec

Disk stats (read/write):
    dm-0: ios=93/257932, merge=0/0, ticks=16/2715548, in_queue=2719824, util=99.85%, aggrios=180/257024, aggrmerge=0/5138, aggrticks=24/2705740, aggrin_queue=2708112, aggrutil=99.67%
  sda: ios=180/257024, merge=0/5138, ticks=24/2705740, in_queue=2708112, util=99.67%
```

重点看到 `write: io=1024.0MB, bw=48273KB/s, iops=12068, runt= 21722msec`，io=1024.0MB 代表随机写了 1GB 的数据；bw=48273KB/s 代表随机写速率为 47MB/s；iops=12068 代表随机写 IOPS 为 12068；runt= 21722msec 代表用时 21ms

#### 测试随机读 IOPS

```

```
