### <font color=#00b0f0>运行环境</font>

```
# uname -a
Linux ubuntu 3.16.0-30-generic #40~14.04.1-Ubuntu SMP Thu Jan 15 17:43:14 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux

# cat /etc/*-release
DISTRIB_DESCRIPTION="Ubuntu 14.04.2 LTS"

# 内存：2G
# CPU：2核
# GDB: 7.7.1
```

---

### 概述

本文讨论的是发生在用户空间的死锁。列举两种情况：1 个线程造成的死锁；2 个线程造成的死锁。通过这两种情况说明如何使用 GDB 调试死锁问题。

演示代码如下：

```
1	#include <stdio.h>
     2	#include <pthread.h>
     3	#include <stdlib.h>
     4	
     5	
     6	pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;
     7	int cnt = 0;
     8	
     9	
    10	void cnt_reset(void)
    11	{
    12		pthread_mutex_lock(&mutex);
    13		cnt = 0;
    14		pthread_mutex_unlock(&mutex);
    15	}
    16	
    17	
    18	void* thr(void *arg)
    19	{
    20		while(1)
    21		{
    22			pthread_mutex_lock(&mutex);
    23			if (cnt > 2)
    24				cnt_reset();
    25			else
    26				cnt++;
    27			pthread_mutex_unlock(&mutex);
    28	
    29			printf("%d\n", cnt);
    30			sleep(1);
    31		}
    32	}
    33	
    34	
    35	int main(void)
    36	{
    37		pthread_t tid;
    38		
    39		pthread_create(&tid, NULL, thr, NULL);
    40		pthread_join(tid, NULL);
    41	
    42		return 0;
    43	}
    44	
```

---

### 调试步骤

#### 1. 识别死锁


