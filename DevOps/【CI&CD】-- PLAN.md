# 导引

本文通过一个实际的例子来讨论步骤 PLAN 的细节，看如何将脑海中的需求落地。

# 方法

## 描述

为了突出重点，这个例子必须足够简单而且完整，这里就以投票功能为例子。

- 需求描述：一个投票系统，假设任何人都可以对每一位候选人进行投票，系统统计每个候选人的得票数，并显示出来
- 交互描述：有两个页面，一个是投票页面，包含单选框的表单；另一个是候选人得票数页面，`<ul>` 和 `<li>` 组成的列表。默认显示候选人得票数页面，点击投票按钮跳转投票页面进行投票，投票完成提交表单，跳转回得票数页面

几个事先声明的点：

- 假设这个投票系统的页面是服务端渲染的，跳转也是服务端控制
- 列表中的数据从另外一个可信任的数据源处导入
- 先不考虑恶意刷票这些问题
- 单元测试用于偏向非业务的代码；接口测试用于偏向业务逻辑的代码

## 步骤

### 1. 流程图

根据描述可以初步完成流程图，演示如下 (下图 START 的 T 没显示出来...)：

![](https://raw.githubusercontent.com/hsxhr-10/picture/master/plan1.png)

这个流程图用什么工具画并不重要，团队内部协商好用什么就行，个人认为用笔和纸画最爽，不过保存麻烦罢了 (手绘画板笑而不语)。重要的是在初步完成这个流程图之后需要确认以下几点：

- 是否漏了方块 (也就是操作步骤)？
- 是否漏了棱形 (也就是分支条件)？
- 已有的方块和棱形是否有错误？

流程图重点是具现化需求的整体情况，同时确保需求的逻辑没有明显的遗漏，一些细节问题 (无论是业务还是技术)，比如得票数列表需要分页吗？需要分多少页？表单需要验证得多细？可以等到细节说明这一步去梳理。当然实际操作起来这两步也不是非得分得很清，往往是边梳理流程图，边讨论细节，这时候就需要同时整理好细节说明了。

### 2. 细节说明

根据流程图就可以进行细节说明的梳理了，梳理的结果最好以文档的形式出来，假设叫【投票系统】-- 细节说明.md。

编辑【投票系统】-- 细节说明.md：

\------------------------------------

\# 得票数页面

- 需要分页，20 条记录为一页
- 过滤掉非党员的人 (滑稽)

\# 投票页面

- 空表单直接 alert 警告，无需发起 HTTP

\------------------------------------

最理想的状态是能在最终的代码实现中，比较容易地跟这些细节说明一一对应起来，这无论对于后期的维护或是工作交接来说都是莫大的帮助。

### 3. 技术讨论 (非必须)

有了【投票系统】-- 细节说明.md，就可以扎实地开技术讨论了，不至于以**大家理解都不一致为前提去讨论如何实现**。可以进一步编辑【投票系统】-- 细节说明.md：

\------------------------------------

\# 得票数页面

- 需要分页，20 条记录为一页  --> 偏非业务，需要单元测试，而且之后的分页都应该使用函数 A，也无需对分页重复测试，只需确保函数 A 有被测试到
- 过滤掉非党员的人 (继续滑稽)   --> 偏业务，需要接口测试

\# 投票页面

- 空表单直接 alert 警告，无需发起 HTTP  --> 偏非业务，需要单元测试

\------------------------------------

考虑到实际情况，如果这些细节都以文档形式落地的话，编写和后期维护的工作量都比较大，特别是对于精致的团队来说。所以可以在技术讨论时，负责相关模块的人员自己记录下来，这还有个好处，就是这些细节自己写、记录往往会更好理解，这就是经常说的别人看不懂，只有自己看得懂。同时，这些技术讨论上面确定下来的东西就是后续 code review 的关键点。

其实上面补充的一些细节很多是不必明说的，可以以团队内部规范的形式出现。比如凡是细节说明里面的功能点，都应该尽量抽出来单独作为一个函数，和文档更好地对应，有利于后期维护；一些非业务的函数用单元测试，业务相关的函数则是依附接口进行接口测试等等。

> 通过技术讨论后，工作量、实现难度、所需时间这些指标也会基本清晰。之所以说这个步骤是非必须的，是因为对于优秀且有默契的技术人员来说，很多细节可能只是一个眼神的事。

如果这次的需求涉及到新建数据表、修改数据表、增删改字段的，也可以在技术讨论时确定这些数据建模的问题。数据建模方面展开说也有很多东西。

### 4. 初步看到可优化点

如果得票数页面的列表内容对于实时性要求不高的话，比如可以接受五分钟的延迟，那么还可以做出以下的优化：

- 假设读压力大，那么可以对得票数页面的列表数据进行缓存
- 假如写压力大，那么可以引入消息队列、异步任务等延迟写。批量写有丢失数据的危险，需要衡量是否能接受
- 当然如果存储层的读写压力都这么大了，前面的负载均衡层、业务层也肯定要水平或垂直扩展了

# 结果

通过上述的方法，我们可以将原本模糊、不清晰、甚至有漏洞的需求给调整过来，并且扎实地落地，为后续的流程打下坚固的基础。
